<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mini Game â€“ Nháº·t Äá»“ng Nhá»</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:#000;
    overflow:hidden;
}

/* Screens */
.screen{
    position:fixed;
    inset:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
    z-index:10;
    color:#fff;
}

/* START SCREEN */
#start{
    background:
    linear-gradient(rgba(0,0,0,.45),rgba(0,0,0,.65)),
    url("assets/start-bg.png") center/cover no-repeat;
}

/* Buttons */
button{
    margin-top:20px;
    padding:14px 30px;
    border:none;
    border-radius:16px;
    font-size:18px;
    font-weight:bold;
    background:#ffb703;
    color:#5a2d00;
}

/* HUD */
#hud{
    position:fixed;
    top:12px;
    left:12px;
    z-index:5;
    color:#fff;
    font-weight:bold;
    text-shadow:0 2px 4px rgba(0,0,0,.7);
    line-height:1.4;
}

/* Canvas */
canvas{
    display:block;
    margin:auto;
    background:none;
}

/* Leaderboard */
#leaderboard{
    background:#fff;
    color:#000;
    padding:14px;
    border-radius:16px;
    width:90%;
    max-width:320px;
}
.rank{
    display:flex;
    justify-content:space-between;
    padding:4px 0;
}
.rank.top{font-weight:bold;color:#d97706}

/* Sparkle effect */
.sparkle{
    position:absolute;
    width:6px;
    height:6px;
    background:gold;
    border-radius:50%;
    animation:sparkle .5s linear forwards;
}
@keyframes sparkle{
    to{opacity:0;transform:translateY(-20px) scale(2);}
}
</style>
</head>

<body>

<!-- START -->
<div id="start" class="screen">
    <h1>âœ¨ NHáº¶T Äá»’NG NHá» âœ¨</h1>
    <p>Tap trÃ¡i / pháº£i Ä‘á»ƒ nÃ© chÆ°á»›ng ngáº¡i</p>
    <p>ğŸ¯ 1000 xu â†’ ğŸ§º Giá» cÃ¡</p>
    <button onclick="startGame()">Báº®T Äáº¦U</button>
</div>

<!-- MILESTONE -->
<div id="milestone" class="screen" style="display:none;background:rgba(0,0,0,.75)">
    <h2>ğŸ‰ CHÃšC Má»ªNG ğŸ‰</h2>
    <p>Äáº¡t <b id="mileText"></b> xu</p>
    <p>ğŸ§º Giá» cÃ¡ xuáº¥t hiá»‡n!</p>
</div>

<!-- GAME OVER -->
<div id="over" class="screen" style="display:none;background:rgba(0,0,0,.85)">
    <h2>Káº¾T QUáº¢</h2>
    <pre id="result"></pre>

    <div id="leaderboard">
        <h3>Báº£ng xáº¿p háº¡ng</h3>
        <div class="rank top">ğŸ¥‡ Player A <span>12,000</span></div>
        <div class="rank top">ğŸ¥ˆ Player B <span>9,500</span></div>
        <div class="rank top">ğŸ¥‰ Player C <span>8,100</span></div>
    </div>

    <button onclick="location.reload()">CHÆ I Láº I</button>
</div>

<!-- HUD -->
<div id="hud">
ğŸ’° Xu: <span id="coin">0</span><br>
ğŸ§º Giá» cÃ¡: <span id="basket">0</span><br>
ğŸ“ Äiá»ƒm: <span id="score">0</span>
</div>

<canvas id="game" width="360" height="640"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* LOAD PNG IMAGES */
const roadImg = new Image();
roadImg.src = "assets/road.png";

const playerImg = new Image();
playerImg.src = "assets/cotam.png";

/* GAME STATE */
let run=false;
let coin=0, score=0, basket=0;
let speed=4;
let nextMilestone=1000;
let milestoneLock=false;

let roadY=0;
let player;
let coins=[], obs=[], baskets=[];
const lanes=[60, 180, 300];

/* START */
function startGame(){
    document.getElementById("start").style.display="none";
    init();
    run=true;
    loop();
}

function init(){
    player={lane:1, y:520};
    coin=score=basket=0;
    speed=4;
    coins=[]; obs=[]; baskets=[];
    nextMilestone=1000;
    milestoneLock=false;
}

/* CONTROL â€“ MOBILE */
canvas.addEventListener("touchstart",e=>{
    const x=e.touches[0].clientX;
    if(x < window.innerWidth/2) player.lane=Math.max(0, player.lane-1);
    else player.lane=Math.min(2, player.lane+1);
});

/* EFFECT */
function sparkle(x,y){
    const s=document.createElement("div");
    s.className="sparkle";
    s.style.left=x+"px";
    s.style.top=y+"px";
    document.body.appendChild(s);
    setTimeout(()=>s.remove(),500);
}

/* SPAWN */
const spawnCoin   = ()=>coins.push({lane:Math.floor(Math.random()*3), y:-20});
const spawnObs    = ()=>obs.push({lane:Math.floor(Math.random()*3), y:-40});
const spawnBasket = ()=>baskets.push({lane:Math.floor(Math.random()*3), y:-60});

/* MILESTONE POPUP */
function showMilestone(v){
    document.getElementById("mileText").innerText=v;
    const m=document.getElementById("milestone");
    m.style.display="flex";
    setTimeout(()=>m.style.display="none",1200);
}

/* MAIN LOOP */
function loop(){
if(!run) return;
ctx.clearRect(0,0,360,640);

/* ROAD SCROLL */
roadY+=speed;
if(roadY>=640) roadY=0;
ctx.drawImage(roadImg,0,roadY-640,360,640);
ctx.drawImage(roadImg,0,roadY,360,640);

/* PLAYER */
ctx.drawImage(
    playerImg,
    lanes[player.lane]-22,
    player.y-30,
    44,
    60
);

/* COINS */
ctx.fillStyle="gold";
coins.forEach(c=>{
    c.y+=speed;
    ctx.beginPath();
    ctx.arc(lanes[c.lane],c.y,8,0,Math.PI*2);
    ctx.fill();
    if(c.lane===player.lane && Math.abs(c.y-player.y)<20){
        coin++;
        sparkle(lanes[c.lane],player.y);
        coins.splice(coins.indexOf(c),1);
    }
});

/* BASKETS â€“ GLOW */
baskets.forEach(b=>{
    b.y+=speed*0.7;
    ctx.save();
    ctx.fillStyle="#ff8c00";
    ctx.shadowColor="gold";
    ctx.shadowBlur=20;
    ctx.fillRect(lanes[b.lane]-16,b.y,32,24);
    ctx.restore();
    if(b.lane===player.lane && Math.abs(b.y-player.y)<24){
        basket++;
        sparkle(lanes[b.lane],player.y);
        baskets.splice(baskets.indexOf(b),1);
    }
});

/* OBSTACLES */
ctx.fillStyle="#c0392b";
obs.forEach(o=>{
    o.y+=speed;
    ctx.fillRect(lanes[o.lane]-16,o.y,32,32);
    if(o.lane===player.lane && Math.abs(o.y-player.y)<24){
        endGame();
    }
});

if(Math.random()<0.03) spawnCoin();
if(Math.random()<0.02) spawnObs();

/* MILESTONE */
if(coin>=nextMilestone && !milestoneLock){
    spawnBasket();
    showMilestone(nextMilestone);
    milestoneLock=true;
    setTimeout(()=>{
        milestoneLock=false;
        nextMilestone+=1000;
    },1500);
}

score++;
speed+=0.001;

/* HUD UPDATE */
document.getElementById("coin").innerText=coin;
document.getElementById("basket").innerText=basket;
document.getElementById("score").innerText=score;

requestAnimationFrame(loop);
}

/* END GAME */
function endGame(){
run=false;
const voucher=Math.floor(basket/3);
document.getElementById("result").innerText=
`ğŸ’° Xu: ${coin}
ğŸ§º Giá» cÃ¡: ${basket}

â˜• Äá»•i quÃ :
${voucher} Voucher Highlands Coffee`;
document.getElementById("over").style.display="flex";
}
</script>
</body>
</html>
