<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Nh·∫∑t ƒê·ªìng Nh·ªè</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{margin:0;background:#000;overflow:hidden;font-family:system-ui}

/* START */
#start{position:fixed;inset:0;z-index:10}
#start img{width:100%;height:100%;object-fit:cover}

/* HUD */
#hud{
 position:fixed;top:12px;left:12px;
 color:#fff;font-weight:bold;
 text-shadow:0 2px 4px rgba(0,0,0,.8);
 z-index:5
}

/* √îNG B·ª§T */
#but{
 position:fixed;
 top:-160px;
 left:50%;
 transform:translateX(-50%);
 width:120px;
 opacity:0;
 transition:.6s ease;
 z-index:8;
}
#but.show{
 top:80px;
 opacity:1;
}

/* R·ªî C√Å */
#basketDrop{
 position:fixed;
 top:140px;
 left:50%;
 transform:translateX(-50%) scale(.5);
 width:60px;
 opacity:0;
 z-index:9;
 pointer-events:none;
}

/* GAME OVER */
#over{
 position:fixed;inset:0;
 display:none;flex-direction:column;
 align-items:center;justify-content:center;
 background:rgba(0,0,0,.9);
 color:#fff;z-index:10;padding:20px
}

button{
 margin-top:16px;
 padding:14px 30px;
 border:none;border-radius:16px;
 font-size:18px;font-weight:bold;
 background:#ffb703;
}
</style>
</head>

<body>

<!-- START -->
<div id="start" onclick="startGame()">
 <img src="assets/start.png">
</div>

<!-- √îNG B·ª§T -->
<img id="but" src="assets/but.png">

<!-- R·ªî C√Å -->
<img id="basketDrop" src="assets/basket.png">

<!-- GAME OVER -->
<div id="over">
 <h2>üèÅ K·∫æT TH√öC</h2>
 <pre id="result"></pre>
 <button onclick="location.reload()">CH∆†I L·∫†I</button>
</div>

<!-- HUD -->
<div id="hud">
 üí∞ Xu: <span id="coinEl">0</span><br>
 üß∫ Gi·ªè c√°: <span id="basketEl">0</span><br>
 üìè ƒêi·ªÉm: <span id="scoreEl">0</span>
</div>

<canvas id="game" width="360" height="640"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

/* IMAGES */
const roadImg=new Image(); roadImg.src="assets/road.png";
const playerImg=new Image(); playerImg.src="assets/cotam-run.png";
const coinImg=new Image(); coinImg.src="assets/coin.png";

/* STATE */
let run=false, coin=0, basket=0, score=0;
let speed=4, roadY=0;
const lanes=[60,180,300];
let player={lane:1,y:520};
let coins=[];
let coinTimer=0;

/* SPRITE */
const RUN_FRAMES=4;
let runFrame=0, runTick=0;
let SPRITE_W=0, SPRITE_H=0;
playerImg.onload=()=>{
 SPRITE_W=playerImg.width/RUN_FRAMES;
 SPRITE_H=playerImg.height;
};

/* START */
function startGame(){
 start.style.display="none";
 run=true; loop();
}

/* CONTROL */
canvas.addEventListener("touchstart",e=>{
 const x=e.touches[0].clientX;
 player.lane = x < innerWidth/2
  ? Math.max(0,player.lane-1)
  : Math.min(2,player.lane+1);
});

/* SPAWN COIN */
const spawnCoin=()=>coins.push({lane:Math.floor(Math.random()*3),y:-20});

/* üß∫ ANIMATION R·ªî C√Å */
function dropBasket(){
 const but=document.getElementById("but");
 const drop=document.getElementById("basketDrop");

 but.classList.add("show");

 setTimeout(()=>{
  drop.style.opacity=1;
  drop.style.top="140px";
  drop.style.transition="none";
  drop.style.transform="translateX(-50%) scale(.5)";
 },200);

 setTimeout(()=>{
  drop.style.transition="top .6s cubic-bezier(.2,.8,.3,1), transform .6s";
  drop.style.top="20px";
  drop.style.transform="translateX(-50%) scale(1)";
 },250);

 setTimeout(()=>{
  basket++;
  basketEl.innerText=basket;
  drop.style.opacity=0;
 },900);

 setTimeout(()=>{
  but.classList.remove("show");
 },1400);
}

/* LOOP */
function loop(){
if(!run)return;
ctx.clearRect(0,0,360,640);

/* ROAD */
roadY+=speed;
if(roadY>=640)roadY=0;
ctx.drawImage(roadImg,0,roadY-640,360,640);
ctx.drawImage(roadImg,0,roadY,360,640);

/* PLAYER */
runTick++; if(runTick%6===0)runFrame=(runFrame+1)%RUN_FRAMES;
if(SPRITE_W){
 ctx.drawImage(
  playerImg,runFrame*SPRITE_W,0,SPRITE_W,SPRITE_H,
  lanes[player.lane]-22,player.y-50,44,66
 );
}

/* COINS */
coins.forEach(c=>{
 c.y+=speed;
 ctx.drawImage(coinImg,lanes[c.lane]-12,c.y-12,24,24);
 if(c.lane===player.lane && Math.abs(c.y-player.y)<20){
  coin++;
  coins.splice(coins.indexOf(c),1);
  coinEl.innerText=coin;

  if(coin%50===0){
    dropBasket();
  }
 }
});

/* TIMER */
coinTimer++;
if(coinTimer>30){spawnCoin();coinTimer=0}

/* SCORE */
score++; speed+=0.001;
scoreEl.innerText=score;

requestAnimationFrame(loop);
}

/* END */
function endGame(){
 run=false;
 result.innerText=
 `Xu: ${coin}
Gi·ªè c√°: ${basket}`;
 over.style.display="flex";
}
</script>
</body>
</html>
